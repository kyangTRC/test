<!DOCTYPE html>
<html>
<body>
<p id="demo"></p>
<p id="test"></p>
<script src="./jquery.min.js"></script>
<script src="./xml2json.js"></script>
<script>
/* HELPER FUNCTION */
function createCORSRequest(method, url) {
    let xhr = new XMLHttpRequest();
    if ("withCredentials" in xhr) {
      // Check if the XMLHttpRequest object has a "withCredentials" property.
      // "withCredentials" only exists on XMLHTTPRequest2 objects.
      xhr.open(method, url, true);
      } else if (typeof XDomainRequest != "undefined") {
        // Otherwise, check if XDomainRequest.
        // XDomainRequest only exists in IE, and is IE's way of making CORS requests.
        xhr = new XDomainRequest();
        xhr.open(method, url);
      } else {
        // Otherwise, CORS is not supported by the browser.
        xhr = null;
      }
      return xhr;
}

/* STEP 1 -- FETCH SIK -- */
const account_user = ["TRCSolutions", "ActUser"];

const t_account_user = ["CRESALES", "TRCTEST"];

let sLoginRequest = "http://parcelstream.com/admin/getSIK.aspx?ACCOUNT=" + t_account_user[0] + "&LOGIN=" + t_account_user[1];

let wkt = "LINESTRING (-95.9621226483684 36.066442984799,-95.9630934684588 36.0657434232634,-95.9630934684588 36.0641015951692,-95.9621226483684 36.0641015951692,-95.9621226483684 36.0611463046)";

var xhrsLoginRequest = createCORSRequest('GET', sLoginRequest);
if (!xhrsLoginRequest) {
  throw new Error('CORS not supported sLoginRequest');
}

function sessionInit(url) {
  let xhttp = new XMLHttpRequest();
  xhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
      parseDemo(this);
    }
  };
  xhttp.open("GET", url);
  xhttp.send();
}

function parseDemo(xml) {
  var xmlDoc = xml.responseXML.document;
  console.log(xml);
  console.log(xmlDoc);
  var x2js = new X2JS();
   $("#demo").val(JSON.stringify(x2js.xml_str2json(xmlDoc)));
}

/*
let temp = http://dc1.parcelstream.com/_T197/InitSession.aspx?sik=_T197/b1034f3f-40a4-44fd-9b77-c11b0eb9d62c-101400_570474633&output=xml
*/
let demoUrl = `http://dc1.parcelstream.com/getQuery.aspx?datasource=SS.Prop.ParcelDetail/ParcelDetail&geo=POLYGON((-117.68585039585565%2033.62778144479256,-117.68514229267572%2033.62718290521123,-117.68509937733148%2033.62689703409304,-117.6852817675445%2033.62687916711664,-117.6861293455932%2033.627575976449805,-117.68585039585565%2033.62778144479256))&SS_Candy=xINBuuymZ0px5mpsdeJucELQxbrSV69xUYJUYA~~&fields=SITE_ADDRESS,SITE_CITY,SITE_STATE,SITE_ZIPCODE,COUNTY,APN,LOCATION_ID,_DMP_ID`;

let xhrdemoUrl = createCORSRequest('GET', demoUrl);
if (!xhrdemoUrl) {
  throw new Error('CORS not supported demoUrl');
}
sessionInit(demoUrl);

</script>
</body>
</html>
